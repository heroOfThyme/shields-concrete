---
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import Image from '~/components/common/Image.astro';
import type { Widget } from '~/types';

export interface ProjectImage {
  src: string;
  alt: string;
  category?: string;
  title?: string;
}

export interface Props extends Widget {
  title?: string;
  subtitle?: string;
  tagline?: string;
  images: ProjectImage[];
  columns?: number;
}

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),
  images = [],
  columns = 3,

  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-7xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <Headline title={title} subtitle={subtitle} tagline={tagline} />

  <div
    class={`grid gap-6 ${
      columns === 4
        ? 'sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4'
        : columns === 3
          ? 'sm:grid-cols-2 lg:grid-cols-3'
          : columns === 2
            ? 'sm:grid-cols-2'
            : 'grid-cols-1'
    }`}
  >
    {
      images.map((project, index) => (
        <div class="relative group overflow-hidden rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 bg-gray-200 dark:bg-slate-800 intersect-once motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade intersect-quarter">
          <div class="aspect-[4/3] overflow-hidden">
            <Image
              src={project.src}
              alt={project.alt}
              class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500 ease-out"
              width={400}
              height={300}
              loading={index < 4 ? 'eager' : 'lazy'}
              decoding="async"
            />
          </div>

          {(project.category || project.title) && (
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300">
              <div class="absolute bottom-0 left-0 right-0 p-4">
                {project.category && (
                  <span class="inline-block px-3 py-1 bg-orange-500 text-white text-sm font-semibold rounded-full mb-2">
                    {project.category}
                  </span>
                )}
                {project.title && <h3 class="text-white font-bold text-lg">{project.title}</h3>}
              </div>
            </div>
          )}
        </div>
      ))
    }
  </div>

  <!-- Bottom CTA Section -->
  <div class="text-center mt-12 p-8 bg-gray-50 dark:bg-slate-800 rounded-xl">
    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Ready to Start Your Project?</h3>
    <p class="text-gray-600 dark:text-gray-300 mb-6 text-lg max-w-2xl mx-auto">
      Get a free, no-obligation quote for your concrete project. We'll work with you to bring your vision to life.
    </p>
    <a
      href="#contact"
      class="inline-flex items-center bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 px-8 rounded-lg transition-colors duration-200 text-lg"
    >
      Get Your Free Quote
      <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
      </svg>
    </a>
  </div>
</WidgetWrapper>
